THREE.MTLLoader=function(r,e,t){this.baseUrl=r,this.options=e,this.crossOrigin=t},THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(r,e){var t=this,a=new THREE.XHRLoader;a.setCrossOrigin(this.crossOrigin),a.load(r,function(r){e(t.parse(r))})},parse:function(r){for(var e=r.split("\n"),t={},a=/\s+/,i={},s=0;s<e.length;s++){var o=e[s];if(o=o.trim(),0!==o.length&&"#"!==o.charAt(0)){var n=o.indexOf(" "),h=n>=0?o.substring(0,n):o;h=h.toLowerCase();var p=n>=0?o.substring(n+1):"";if(p=p.trim(),"newmtl"===h)t={name:p},i[p]=t;else if(t)if("ka"===h||"kd"===h||"ks"===h){var d=p.split(a,3);t[h]=[parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2])]}else t[h]=p}}var T=new THREE.MTLLoader.MaterialCreator(this.baseUrl,this.options);return T.setMaterials(i),T}},THREE.MTLLoader.MaterialCreator=function(r,e){this.baseUrl=r,this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,setMaterials:function(r){this.materialsInfo=this.convert(r),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(r){if(!this.options)return r;var e={};for(var t in r){var a=r[t],i={};e[t]=i;for(var s in a){var o=!0,n=a[s],h=s.toLowerCase();switch(h){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(n=[n[0]/255,n[1]/255,n[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===n[0]&&0===n[1]&&0===n[1]&&(o=!1);break;case"d":this.options&&this.options.invertTransparency&&(n=1-n)}o&&(i[h]=n)}}return e},preload:function(){for(var r in this.materialsInfo)this.create(r)},getIndex:function(r){return this.nameLookup[r]},getAsArray:function(){var r=0;for(var e in this.materialsInfo)this.materialsArray[r]=this.create(e),this.nameLookup[e]=r,r++;return this.materialsArray},create:function(r){return void 0===this.materials[r]&&this.createMaterial_(r),this.materials[r]},createMaterial_:function(r){var e=this.materialsInfo[r],t={name:r,side:this.side};for(var a in e){var i=e[a];switch(a.toLowerCase()){case"kd":t.diffuse=(new THREE.Color).fromArray(i);break;case"ka":t.ambient=(new THREE.Color).fromArray(i);break;case"ks":t.specular=(new THREE.Color).fromArray(i);break;case"map_kd":t.map=this.loadTexture(this.baseUrl+i),t.map.wrapS=this.wrap,t.map.wrapT=this.wrap;break;case"ns":t.shininess=i;break;case"d":1>i&&(t.transparent=!0,t.opacity=i)}}return t.diffuse&&(t.ambient||(t.ambient=t.diffuse),t.color=t.diffuse),this.materials[r]=new THREE.MeshPhongMaterial(t),this.materials[r]},loadTexture:function(r,e,t,a){var i=/\.dds$/i.test(r);if(i)var s=THREE.ImageUtils.loadCompressedTexture(r,e,t,a);else{var o=new Image,s=new THREE.Texture(o,e),n=new THREE.ImageLoader;n.crossOrigin=this.crossOrigin,n.load(r,function(r){s.image=THREE.MTLLoader.ensurePowerOfTwo_(r),s.needsUpdate=!0,t&&t(s)})}return s}},THREE.MTLLoader.ensurePowerOfTwo_=function(r){if(!THREE.MTLLoader.isPowerOfTwo_(r.width)||!THREE.MTLLoader.isPowerOfTwo_(r.height)){var e=document.createElement("canvas");e.width=THREE.MTLLoader.nextHighestPowerOfTwo_(r.width),e.height=THREE.MTLLoader.nextHighestPowerOfTwo_(r.height);var t=e.getContext("2d");return t.drawImage(r,0,0,r.width,r.height,0,0,e.width,e.height),e}return r},THREE.MTLLoader.isPowerOfTwo_=function(r){return 0===(r&r-1)},THREE.MTLLoader.nextHighestPowerOfTwo_=function(r){--r;for(var e=1;32>e;e<<=1)r|=r>>e;return r+1},THREE.EventDispatcher.prototype.apply(THREE.MTLLoader.prototype);