THREE.TrackballControls=function(e,t){function n(e){u.enabled!==!1&&(window.removeEventListener("keydown",n),m=g,g===p.NONE&&(e.keyCode!==u.keys[p.ROTATE]||u.noRotate?e.keyCode!==u.keys[p.ZOOM]||u.noZoom?e.keyCode!==u.keys[p.PAN]||u.noPan||(g=p.PAN):g=p.ZOOM:g=p.ROTATE))}function o(){u.enabled!==!1&&(g=m,window.addEventListener("keydown",n,!1))}function a(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),g===p.NONE&&(g=e.button),g!==p.ROTATE||u.noRotate?g!==p.ZOOM||u.noZoom?g!==p.PAN||u.noPan||(w=u.getMouseOnScreen(e.clientX,e.clientY),M.copy(w)):(b=u.getMouseOnScreen(e.clientX,e.clientY),y.copy(b)):(O=u.getMouseProjectionOnBall(e.clientX,e.clientY),v.copy(O)),document.addEventListener("mousemove",i,!1),document.addEventListener("mouseup",s,!1))}function i(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),g!==p.ROTATE||u.noRotate?g!==p.ZOOM||u.noZoom?g!==p.PAN||u.noPan||(M=u.getMouseOnScreen(e.clientX,e.clientY)):y=u.getMouseOnScreen(e.clientX,e.clientY):v=u.getMouseProjectionOnBall(e.clientX,e.clientY))}function s(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),g=p.NONE,document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",s))}function c(e){if(u.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),b.y+=.01*t}}function r(e){if(u.enabled!==!1)switch(e.touches.length){case 1:g=p.TOUCH_ROTATE,O=v=u.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:g=p.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;T=f=Math.sqrt(t*t+n*n);break;case 3:g=p.TOUCH_PAN,w=M=u.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY);break;default:g=p.NONE}}function h(e){if(u.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:v=u.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;T=Math.sqrt(t*t+n*n);break;case 3:M=u.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY);break;default:g=p.NONE}}function l(e){if(u.enabled!==!1){switch(e.touches.length){case 1:O=v=u.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:f=T=0;break;case 3:w=M=u.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)}g=p.NONE}}var u=this,p={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var d=new THREE.Vector3,g=p.NONE,m=p.NONE,E=new THREE.Vector3,O=new THREE.Vector3,v=new THREE.Vector3,b=new THREE.Vector2,y=new THREE.Vector2,f=0,T=0,w=new THREE.Vector2,M=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var R={type:"change"};this.handleResize=function(){this.domElement===document?(this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight):this.screen=this.domElement.getBoundingClientRect()},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.getMouseOnScreen=function(e,t){return new THREE.Vector2((e-u.screen.left)/u.screen.width,(t-u.screen.top)/u.screen.height)},this.getMouseProjectionOnBall=function(e,t){var n=new THREE.Vector3((e-.5*u.screen.width-u.screen.left)/(.5*u.screen.width),(.5*u.screen.height+u.screen.top-t)/(.5*u.screen.height),0),o=n.length();u.noRoll?n.z=o<Math.SQRT1_2?Math.sqrt(1-o*o):.5/o:o>1?n.normalize():n.z=Math.sqrt(1-o*o),E.copy(u.object.position).sub(u.target);var a=u.object.up.clone().setLength(n.y);return a.add(u.object.up.clone().cross(E).setLength(n.x)),a.add(E.setLength(n.z)),a},this.rotateCamera=function(){var e=Math.acos(O.dot(v)/O.length()/v.length());if(e){var t=(new THREE.Vector3).crossVectors(O,v).normalize(),n=new THREE.Quaternion;e*=u.rotateSpeed,n.setFromAxisAngle(t,-e),E.applyQuaternion(n),u.object.up.applyQuaternion(n),v.applyQuaternion(n),u.staticMoving?O.copy(v):(n.setFromAxisAngle(t,e*(u.dynamicDampingFactor-1)),O.applyQuaternion(n))}},this.zoomCamera=function(){if(g===p.TOUCH_ZOOM){var e=f/T;f=T,E.multiplyScalar(e)}else{var e=1+(y.y-b.y)*u.zoomSpeed;1!==e&&e>0&&(E.multiplyScalar(e),u.staticMoving?b.copy(y):b.y+=(y.y-b.y)*this.dynamicDampingFactor)}},this.panCamera=function(){var e=M.clone().sub(w);if(e.lengthSq()){e.multiplyScalar(E.length()*u.panSpeed);var t=E.clone().cross(u.object.up).setLength(e.x);t.add(u.object.up.clone().setLength(e.y)),u.object.position.add(t),u.target.add(t),u.staticMoving?w=M:w.add(e.subVectors(M,w).multiplyScalar(u.dynamicDampingFactor))}},this.checkDistances=function(){u.noZoom&&u.noPan||(E.lengthSq()>u.maxDistance*u.maxDistance&&u.object.position.addVectors(u.target,E.setLength(u.maxDistance)),E.lengthSq()<u.minDistance*u.minDistance&&u.object.position.addVectors(u.target,E.setLength(u.minDistance)))},this.update=function(){E.subVectors(u.object.position,u.target),u.noRotate||u.rotateCamera(),u.noZoom||u.zoomCamera(),u.noPan||u.panCamera(),u.object.position.addVectors(u.target,E),u.checkDistances(),u.object.lookAt(u.target),d.distanceToSquared(u.object.position)>0&&(u.dispatchEvent(R),d.copy(u.object.position))},this.reset=function(){g=p.NONE,m=p.NONE,u.target.copy(u.target0),u.object.position.copy(u.position0),u.object.up.copy(u.up0),E.subVectors(u.object.position,u.target),u.object.lookAt(u.target),u.dispatchEvent(R),d.copy(u.object.position)},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",a,!1),this.domElement.addEventListener("mousewheel",c,!1),this.domElement.addEventListener("DOMMouseScroll",c,!1),this.domElement.addEventListener("touchstart",r,!1),this.domElement.addEventListener("touchend",l,!1),this.domElement.addEventListener("touchmove",h,!1),window.addEventListener("keydown",n,!1),window.addEventListener("keyup",o,!1),this.handleResize()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);